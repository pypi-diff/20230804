# Comparing `tmp/pytket_cutensornet-0.2.0-py3-none-any.whl.zip` & `tmp/pytket_cutensornet-0.2.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,18 +1,18 @@
-Zip file size: 43853 bytes, number of entries: 16
--rw-r--r--  2.0 unx     1066 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/__init__.py
--rw-r--r--  2.0 unx       74 b- defN 23-Jul-12 14:33 pytket/extensions/cutensornet/_metadata.py
--rw-r--r--  2.0 unx    29214 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/tensor_network_convert.py
--rw-r--r--  2.0 unx     2630 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/utils.py
--rw-r--r--  2.0 unx      705 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/backends/__init__.py
--rw-r--r--  2.0 unx    11284 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/backends/cutensornet_backend.py
--rw-r--r--  2.0 unx     1135 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/mps/__init__.py
--rw-r--r--  2.0 unx    31966 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/mps/mps.py
--rw-r--r--  2.0 unx    14632 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/mps/mps_gate.py
--rw-r--r--  2.0 unx    23867 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/mps/mps_mpo.py
--rw-r--r--  2.0 unx     9464 b- defN 23-Jul-12 14:31 pytket/extensions/cutensornet/mps/simulation.py
--rw-r--r--  2.0 unx    11356 b- defN 23-Jul-12 14:33 pytket_cutensornet-0.2.0.dist-info/LICENSE
--rw-r--r--  2.0 unx     5168 b- defN 23-Jul-12 14:33 pytket_cutensornet-0.2.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-12 14:33 pytket_cutensornet-0.2.0.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-12 14:33 pytket_cutensornet-0.2.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1578 b- defN 23-Jul-12 14:33 pytket_cutensornet-0.2.0.dist-info/RECORD
-16 files, 144238 bytes uncompressed, 41171 bytes compressed:  71.5%
+Zip file size: 43777 bytes, number of entries: 16
+-rw-r--r--  2.0 unx     1066 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/__init__.py
+-rw-r--r--  2.0 unx       74 b- defN 23-Aug-04 13:59 pytket/extensions/cutensornet/_metadata.py
+-rw-r--r--  2.0 unx    29689 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/tensor_network_convert.py
+-rw-r--r--  2.0 unx     2630 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/utils.py
+-rw-r--r--  2.0 unx      705 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/backends/__init__.py
+-rw-r--r--  2.0 unx    10832 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/backends/cutensornet_backend.py
+-rw-r--r--  2.0 unx     1135 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/mps/__init__.py
+-rw-r--r--  2.0 unx    31966 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/mps/mps.py
+-rw-r--r--  2.0 unx    15049 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/mps/mps_gate.py
+-rw-r--r--  2.0 unx    23867 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/mps/mps_mpo.py
+-rw-r--r--  2.0 unx     9464 b- defN 23-Aug-04 13:57 pytket/extensions/cutensornet/mps/simulation.py
+-rw-r--r--  2.0 unx    11356 b- defN 23-Aug-04 13:59 pytket_cutensornet-0.2.1.dist-info/LICENSE
+-rw-r--r--  2.0 unx     5168 b- defN 23-Aug-04 13:59 pytket_cutensornet-0.2.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Aug-04 13:59 pytket_cutensornet-0.2.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Aug-04 13:59 pytket_cutensornet-0.2.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1578 b- defN 23-Aug-04 13:59 pytket_cutensornet-0.2.1.dist-info/RECORD
+16 files, 144678 bytes uncompressed, 41095 bytes compressed:  71.6%
```

## zipnote {}

```diff
@@ -27,23 +27,23 @@
 
 Filename: pytket/extensions/cutensornet/mps/mps_mpo.py
 Comment: 
 
 Filename: pytket/extensions/cutensornet/mps/simulation.py
 Comment: 
 
-Filename: pytket_cutensornet-0.2.0.dist-info/LICENSE
+Filename: pytket_cutensornet-0.2.1.dist-info/LICENSE
 Comment: 
 
-Filename: pytket_cutensornet-0.2.0.dist-info/METADATA
+Filename: pytket_cutensornet-0.2.1.dist-info/METADATA
 Comment: 
 
-Filename: pytket_cutensornet-0.2.0.dist-info/WHEEL
+Filename: pytket_cutensornet-0.2.1.dist-info/WHEEL
 Comment: 
 
-Filename: pytket_cutensornet-0.2.0.dist-info/top_level.txt
+Filename: pytket_cutensornet-0.2.1.dist-info/top_level.txt
 Comment: 
 
-Filename: pytket_cutensornet-0.2.0.dist-info/RECORD
+Filename: pytket_cutensornet-0.2.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## pytket/extensions/cutensornet/_metadata.py

```diff
@@ -1,2 +1,2 @@
-__extension_version__ = "0.2.0"
+__extension_version__ = "0.2.1"
 __extension_name__ = "pytket-cutensornet"
```

## pytket/extensions/cutensornet/tensor_network_convert.py

```diff
@@ -67,14 +67,17 @@
 
         Resulting tensor network in einsum notation suitable to use with cuTensorNet.
 
         Args:
             circuit: A pytket circuit to be converted to a tensor network.
             adj: Whether to create an adjoint representation of the original circuit.
             loglevel: Internal logger output level.
+
+        Raises:
+            RuntimeError: If ``Box`` objects are present in the circuit.
         """
         self._logger = set_logger("TensorNetwork", loglevel)
         self._circuit = circuit
         # self._circuit.replace_implicit_wire_swaps()
         self._qubit_names_ilo = [str(q) for q in self._circuit.qubits]
         self._logger.debug(f"ILO-ordered qubit names: {self._qubit_names_ilo}")
         self._graph = Graph(self._circuit)
@@ -109,20 +112,30 @@
         Args:
             adj: Whether an adjoint representation of the original circuit is to be
              created.
 
         Returns:
             A map between the gate type and corresponding tensor representation(s).
 
+        Raises:
+            RuntimeError: If ``Box`` objects are present in the circuit.
+
         Note:
            The returned map values are lists and may contain more than one
            representation - for >1-qubit gates, different topologies (e.g. upward and
            downward) are taken into account.
         """
         name_set = {com.op.get_name() for com in self._circuit.get_commands()}
+        for name in name_set:
+            if "Box" in name:
+                raise RuntimeError(
+                    "Currently TensorNetwork does not accept pytket Box"
+                    " objects. Please first run"
+                    " ``DecomposeBoxes().apply(circuit)``"
+                )
         gate_tensors = defaultdict(list)
         for i in name_set:
             for com in self._circuit.get_commands():
                 if i == com.op.get_name():
                     if adj:
                         gate_tensors[i].append(
                             com.op.get_unitary()
```

## pytket/extensions/cutensornet/backends/cutensornet_backend.py

```diff
@@ -32,45 +32,86 @@
 from pytket.backends.resulthandle import _ResultIdTuple
 from pytket.extensions.cutensornet.tensor_network_convert import (
     TensorNetwork,
     ExpectationValueTensorNetwork,
     tk_to_tensor_network,
     measure_qubits_state,
 )
-from pytket.predicates import Predicate, GateSetPredicate, NoClassicalBitsPredicate  # type: ignore
+from pytket.passes import auto_rebase_pass
+from pytket.predicates import (  # type: ignore
+    Predicate,
+    GateSetPredicate,
+    NoClassicalBitsPredicate,
+    NoSymbolsPredicate,
+)
 from pytket.passes import (  # type: ignore
     BasePass,
     SequencePass,
     DecomposeBoxes,
+    RemoveRedundancies,
     SynthesiseTket,
     FullPeepholeOptimise,
-    RebaseCustom,
-    SquashCustom,
 )
 from pytket.utils.operators import QubitPauliOperator
 
 
-# TODO: this is temporary - probably don't need it eventually?
-def _sq(a: Expr, b: Expr, c: Expr) -> Circuit:
-    circ = Circuit(1)
-    if c != 0:
-        circ.Rz(c, 0)
-    if b != 0:
-        circ.Rx(b, 0)
-    if a != 0:
-        circ.Rz(a, 0)
-    return circ
-
-
 class CuTensorNetBackend(Backend):
     """A pytket Backend wrapping around the cuTensorNet simulator."""
 
     _supports_state = True
     _supports_expectation = True
     _persistent_handles = False
+    _GATE_SET = {
+        OpType.X,
+        OpType.Y,
+        OpType.Z,
+        OpType.S,
+        OpType.Sdg,
+        OpType.T,
+        OpType.Tdg,
+        OpType.V,
+        OpType.Vdg,
+        OpType.SX,
+        OpType.SXdg,
+        OpType.H,
+        OpType.Rx,
+        OpType.Ry,
+        OpType.Rz,
+        OpType.U1,
+        OpType.U2,
+        OpType.U3,
+        OpType.TK1,
+        OpType.TK2,
+        OpType.CX,
+        OpType.CY,
+        OpType.CZ,
+        OpType.CH,
+        OpType.CV,
+        OpType.CVdg,
+        OpType.CSX,
+        OpType.CSXdg,
+        OpType.CRz,
+        OpType.CRy,
+        OpType.CRx,
+        OpType.CU1,
+        OpType.CU3,
+        OpType.CCX,
+        OpType.ECR,
+        OpType.SWAP,
+        OpType.CSWAP,
+        OpType.ISWAP,
+        OpType.XXPhase,
+        OpType.YYPhase,
+        OpType.ZZPhase,
+        OpType.ZZMax,
+        OpType.ESWAP,
+        OpType.PhasedX,
+        OpType.FSim,
+        OpType.Sycamore,
+    }
 
     # TODO: add self._backend_info?
     def __init__(self) -> None:
         """Constructs a new cuTensorNet backend object."""
         super().__init__()
 
     @property
@@ -80,59 +121,39 @@
     # TODO: return some info? Should it return self._backend_info instantiated on
     #  construction?
     @property
     def backend_info(self) -> Optional[BackendInfo]:
         """Returns information on the backend."""
         return None
 
-    # TODO: Surely we can allow for more gate sets - needs thorough testing though.
     @property
     def required_predicates(self) -> List[Predicate]:
         """Returns the minimum set of predicates that a circuit must satisfy.
 
         Predicates need to be satisfied before the circuit can be successfully run on
         this backend.
 
         Returns:
             List of required predicates.
         """
         preds = [
             NoClassicalBitsPredicate(),
-            GateSetPredicate(
-                {
-                    OpType.Rx,
-                    OpType.Ry,
-                    OpType.Rz,
-                    OpType.ZZMax,
-                }
-            ),
+            NoSymbolsPredicate(),
+            GateSetPredicate(self._GATE_SET),
         ]
         return preds
 
-    # TODO: also probably needs improvement.
     def rebase_pass(self) -> BasePass:
         """Defines rebasing method.
 
         Returns:
-            Custom rebase pass object.
+            Automatic rebase pass object based on the backend gate set.
         """
-        cx_circ = Circuit(2)
-        cx_circ.Sdg(0)
-        cx_circ.V(1)
-        cx_circ.Sdg(1)
-        cx_circ.Vdg(1)
-        cx_circ.add_gate(OpType.ZZMax, [0, 1])
-        cx_circ.Vdg(1)
-        cx_circ.Sdg(1)
-        cx_circ.add_phase(0.5)
-        return RebaseCustom(
-            {OpType.Rx, OpType.Ry, OpType.Rz, OpType.ZZMax}, cx_circ, _sq
-        )
+        return auto_rebase_pass(self._GATE_SET)
 
-    # TODO: same as above?
     def default_compilation_pass(self, optimisation_level: int = 1) -> BasePass:
         """Returns a default compilation pass.
 
         A suggested compilation pass that will guarantee the resulting circuit
         will be suitable to run on this backend with as few preconditions as
         possible.
 
@@ -142,25 +163,23 @@
                 optimising. Level 1 additionally performs some light optimisations.
                 Level 2 adds more intensive optimisations that can increase compilation
                 time for large circuits. Defaults to 1.
         Returns:
             Compilation pass guaranteeing required predicates.
         """
         assert optimisation_level in range(3)
-        squash = SquashCustom({OpType.Rz, OpType.Rx, OpType.Ry}, _sq)
-        seq = [DecomposeBoxes()]  # Decompose boxes into basic gates
+        seq = [
+            DecomposeBoxes(),
+            RemoveRedundancies(),
+        ]  # Decompose boxes into basic gates
         if optimisation_level == 1:
             seq.append(SynthesiseTket())  # Optional fast optimisation
         elif optimisation_level == 2:
             seq.append(FullPeepholeOptimise())  # Optional heavy optimisation
         seq.append(self.rebase_pass())  # Map to target gate set
-        if optimisation_level != 0:
-            seq.append(
-                squash
-            )  # Optionally simplify 1qb gate chains within this gate set
         return SequencePass(seq)
 
     def circuit_status(self, handle: ResultHandle) -> CircuitStatus:
         """Returns circuit status object.
 
         Returns:
             CircuitStatus object.
@@ -207,23 +226,15 @@
                 coeff = np.exp(phase * np.pi * 1j)
                 state *= coeff  # type: ignore
             except TypeError:
                 warning(
                     "Global phase is dependent on a symbolic parameter, so cannot "
                     "adjust for phase"
                 )
-            # Qubits order:
-            # implicit_perm = circuit.implicit_qubit_permutation()
-            # res_qubits = [
-            #     implicit_perm[qb] for qb in sorted(circuit.qubits, reverse=False)
-            # ]  # reverse was set to True in the pytket-example but this fails tests.
             res_qubits = [qb for qb in sorted(circuit.qubits)]
-            # The below line is as per pytket-Qulacs, but this alone fails the implicit
-            # permutation test result.
-            # res_qubits = sorted(circuit.qubits, reverse=False)
             handle = ResultHandle(str(uuid4()))
             self._cache[handle] = {
                 "result": BackendResult(q_bits=res_qubits, state=state)
             }
             handle_list.append(handle)
         return handle_list
```

## pytket/extensions/cutensornet/mps/mps_gate.py

```diff
@@ -104,14 +104,24 @@
         truncating = new_dim > self.chi or self.truncation_fidelity < 1
         if truncating:
             # If truncation required, convert to canonical form before
             # contracting. Avoids the need to apply gauge transformations
             # to the larger tensor resulting from the contraction.
             self.canonicalise(l_pos, r_pos)
 
+            # Since canonicalisation may change the dimension of the bonds,
+            # we need to recalculate the value of `new_dim`
+            if l_pos == 0 or r_pos == len(self) - 1:
+                new_dim = 2
+            else:
+                new_dim = 2 * min(
+                    self.get_virtual_dimensions(l_pos)[0],
+                    self.get_virtual_dimensions(r_pos)[1],
+                )
+
         # Load the gate's unitary to the GPU memory
         gate_unitary = gate.get_unitary().astype(dtype=self._complex_t, copy=False)
         gate_tensor = cp.asarray(gate_unitary, dtype=self._complex_t)
 
         # Reshape into a rank-4 tensor
         gate_tensor = cp.reshape(gate_tensor, (2, 2, 2, 2))
```

## Comparing `pytket_cutensornet-0.2.0.dist-info/LICENSE` & `pytket_cutensornet-0.2.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `pytket_cutensornet-0.2.0.dist-info/METADATA` & `pytket_cutensornet-0.2.1.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pytket-cutensornet
-Version: 0.2.0
+Version: 0.2.1
 Summary: Extension for pytket, providing access to the cuTensorNet Python API.
 Author: TKET development team
 Author-email: tket-support@cambridgequantum.com
 License: Apache 2
 Project-URL: Documentation, https://cqcl.github.io/pytket-cutensornet/api/index.html
 Project-URL: Source, https://github.com/CQCL/pytket-cutensornet
 Project-URL: Tracker, https://github.com/CQCL/pytket-cutensornet/issues
```

## Comparing `pytket_cutensornet-0.2.0.dist-info/RECORD` & `pytket_cutensornet-0.2.1.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 pytket/extensions/cutensornet/__init__.py,sha256=RRlGa_r6H3KZQfU_hGgZdHVZz4EF50NQpvi3H9X-O5Y,1066
-pytket/extensions/cutensornet/_metadata.py,sha256=s9qoH1MDG-_9sGPnKQj_Ttght2LLn0ZZFCpyOvX_Vrk,74
-pytket/extensions/cutensornet/tensor_network_convert.py,sha256=UDCZHK9ei0IZAY6Bb1wfV1Vh6ELf-r7ee0E77kfXTXU,29214
+pytket/extensions/cutensornet/_metadata.py,sha256=ljvDDkfnA6yLJpGP4V5P-RKRoLyBPhf7jtCU9a9_nuE,74
+pytket/extensions/cutensornet/tensor_network_convert.py,sha256=JSF_aB5jbf5Kpv8t8kK19pdGpk5Vmhk6JjSOrptDlLw,29689
 pytket/extensions/cutensornet/utils.py,sha256=jbARtDYxf461tzdOv30SOIeazRVFpXCvlXWfnwxfK04,2630
 pytket/extensions/cutensornet/backends/__init__.py,sha256=5VZh6ritj1Hj8q7JwsFj2JmAIBO59d3LlaxKwFboDU8,705
-pytket/extensions/cutensornet/backends/cutensornet_backend.py,sha256=WtrIoOS01KVeh07s5bbPND06dwjiDR6ltHoK-31TvWE,11284
+pytket/extensions/cutensornet/backends/cutensornet_backend.py,sha256=JDbMahgusVcgqjlEP3NsE-UcNX_V8jjSgE3USkI2oQg,10832
 pytket/extensions/cutensornet/mps/__init__.py,sha256=DVM3q0DmjshOSSCBv9uGZdRfmGtjjOLKMLTGAcxwK1Q,1135
 pytket/extensions/cutensornet/mps/mps.py,sha256=f36wRCUVCa6H7JAy6D-rLExmSq6MClLL47Cujyv9zC0,31966
-pytket/extensions/cutensornet/mps/mps_gate.py,sha256=oTMu94bxiT-oL3I8LF_fuCtK4WI-EF7fG_RHPAQAF90,14632
+pytket/extensions/cutensornet/mps/mps_gate.py,sha256=Q_rNMT3iRnnv10q67ix4CnSSTh0tqUl1DqTVlfVIEvo,15049
 pytket/extensions/cutensornet/mps/mps_mpo.py,sha256=LF24SCkEGo8Bsopzh2ZA-7CDBwGemToZdfGWhbom_oc,23867
 pytket/extensions/cutensornet/mps/simulation.py,sha256=Vcw7_C0A0FZQKf5iKrcLhBtcZK0PwaSd_W_t5I4lMGs,9464
-pytket_cutensornet-0.2.0.dist-info/LICENSE,sha256=QwcOLU5TJoTeUhuIXzhdCEEDDvorGiC6-3YTOl4TecE,11356
-pytket_cutensornet-0.2.0.dist-info/METADATA,sha256=XgCf6EHy4eEr6_BbeDKlpVR91kYU3b37D7xV7QTN6N8,5168
-pytket_cutensornet-0.2.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-pytket_cutensornet-0.2.0.dist-info/top_level.txt,sha256=GsvCQQpJ7P8Vrx4ydtbjs36yufXiD59vSbbQFtFgcQ0,7
-pytket_cutensornet-0.2.0.dist-info/RECORD,,
+pytket_cutensornet-0.2.1.dist-info/LICENSE,sha256=QwcOLU5TJoTeUhuIXzhdCEEDDvorGiC6-3YTOl4TecE,11356
+pytket_cutensornet-0.2.1.dist-info/METADATA,sha256=uLfpf9GvXXi6zQz2A0Q7LlWSPp7ql8xhK_StIriTA-A,5168
+pytket_cutensornet-0.2.1.dist-info/WHEEL,sha256=AtBG6SXL3KF_v0NxLf0ehyVOh0cold-JbJYXNGorC6Q,92
+pytket_cutensornet-0.2.1.dist-info/top_level.txt,sha256=GsvCQQpJ7P8Vrx4ydtbjs36yufXiD59vSbbQFtFgcQ0,7
+pytket_cutensornet-0.2.1.dist-info/RECORD,,
```

